#### "Новостной портал" - от SkillFacTory
# News Portal
я обучаюсь на курсе _"Профессия Python-разработчик"_ от компании СкиллФакТори.
у меня есть отдельные репозитории, в которых я выполняю все обучающие задания этого курса. 
один по [Питону](https://github.com/Archangel-Ray/SkillFactory_courses-profession-Python), 
второй по [Джанго](https://github.com/Archangel-Ray/SkillFactory_project_django).
здесь, получилось два проекта Джанго. 

## ["Дипломная работа"](news_paper)
на протяжении курса, по степени освоения Джанго, даются конкретные задания, которые нужно выполнить в этом проекте. 
в итоге должно получиться полноценное приложение. (я наивный, на протяжении всего курса так думал)

`>>> в_коммитах = 'можно пересмотреть весь процесс'`

### в итоге, в этом проекте реализовано:
#### модели:
- Автор:
  - поля:
    - автор - привязка один-к-одному к модели User
    - рейтинг - числовое поле, по умолчанию = 0
  - методы:
    - обновление рейтинга - суммирует рейтинги постов и комментариев автора


- Категория:
  - поля:
    - название - уникальное текстовое поле
    - подписчики - привязка к модели "User" многие-ко-многим


- Пост:
  - поля:
    - автор - привязка к модели "Автор" один-ко-многим
    - тип - выпадающий список: "Новость" или "Статья"
    - дата создания - поле дата/время с авто-добавлением текущего времени
    - категория - привязка к модели "Категория" многие-ко-многим
    - название - короткое текстовое поле
    - текст - текстовое поле
    - рейтинг - числовое поле, по умолчанию = 0
  - методы:
    - оценить - добавляет единицу к рейтингу
    - снять оценку - отнимает единицу от рейтинга
    - предпросмотр - обрезает текст в поле "текст" и добавляет в конце троеточие


- Категория поста - промежуточная таблица
  - поля:
    - связь с моделью "Пост" один-ко-многим
    - связь с моделью "Категория" один-ко-многим


- Комментарии:
  - поля:
    - пост - привязка к модели "Пост" один-ко-многим
    - автор комментария - привязка к модели "User" один-ко-многим
    - текст - текстовое поле
    - дата создания - поле дата/время с авто добавлением текущего времени
    - рейтинг - числовое поле, по умолчанию = 0
  - методы:
    - строковое представление - имя автора поста, если удаётся его получить. или автор комментария
    - оценить - добавляет единицу к рейтингу
    - снять оценку - отнимает единицу от рейтинга

все модели зарегистрированы в админ-панели. подсчёт рейтинга, оценки и комментарии на сайте никак не реализованы, 
(не было такого задания).

#### отображение
посты выводятся в виде таблицы. можно вывести каждый пост по отдельности. есть возможность публиковать, редактировать 
и удалять посты. организован поиск по названиям постов, а также по дате создания и автору. можно отдельно 
вывести посты определённой категории. есть возможность цензурирования по определённым словам. включена пагинация, 
на одной странице выводится по десять постов. переход возможен на соседние и крайние страницы. фон страницы зависит 
от времени суток, можно выбрать другой часовой пояс.

#### собственный фильтр
создан и подключён собственный фильтр. он позволяет находить в тексте определённые слова и заменяет их на заданный 
символ.

#### организация поиска
поиск на странице реализован с помощью пакета "django_filters". стандартный поиск по текстовому полю названия. 
поле "Автор" - выпадающий список, куда подставляется существующие авторы. можно выводить посты выбранного автора. 
в поле поиска по дате есть выпадающая таблица где можно выбрать нужную дату. выводятся все посты после указанной даты.

#### авторизация
авторизация и аутентификация организована с помощью пакета "allauth". аутентификация происходит через эл.почту или 
через Яндекс провайдера. эл-почта проверяется и подтверждается. на указанный адрес отправляется письмо с подтверждением. 
создавать и редактировать посты могут только авторизованные пользователи, которые добавлены в группу авторов. 
##### _ограничения и настройки зависящие от авторизации и аутентификации_
в личном кабинете пользователь может добавиться в группу авторов. на странице с выборкой по тематикам есть возможность 
подписаться на выбранную тематику. ограничено количество постов для одного автора которые он может опубликовать за день.

#### рассылки на эл-почту
во время регистрации отправляется письмо на указанную эл-почту для подтверждения. плюс к этому сообщение отправляется 
при подписке на тематику и при отмене этой подписки. отправляется оповещение о новом посте в теме на которую оформлена 
подписка, со ссылкой на него и сокращённым текстом. в начале отправка о новом посте была реализована через сигналы 
диспетчеру Джанго.
##### _django-apscheduler_
еженедельная рассылка в начале была сделана с помощью django-apscheduler. в сообщении перечислены все посты 
за последние семь дней в той теме на которую оформлена подписка. 
##### _Celery и Redis_
такая стратегия курса. не стали придумывать новые возможности для проекта, а просто переложили старые. теперь 
отправки сообщений о новом посте и еженедельная рассылка реализованы с помощью Селери в Редисе. какой вариант лучше 
мне сейчас сложно сказать. возможно если нагрузка возрастёт в десятки тысяч раз реализация с помощью Redis несомненно 
выиграет. но и apscheduler тоже справлялся с задачей рассылки, при небольшом объёме его было достаточно. для Селери 
можно было придумать задачу по масштабней чем еженедельная рассылка.

#### кеширование
кеширование включено на выводе всех постов, при чём делается проверка на наличие поста в кеше. реализовано 
в представлении. отдельно кешируется шапка основной страницы в шаблоне. страница вывода отдельного поста кешируется на 
60 секунд во время перехода на неё. при сохранении поста после редактирования он удаляется из кеша и считывается заново 
когда отображается весь список.

#### выгрузка базы в json
отработал выгрузку и заполнение базы. добавлена команда для manage.py на удаление всех постов заданной тематики.

#### админ-панель
в админ панели настроено отображение всех постов с возможностью установить другую категорию всем выбранным постам. 
выведены фильтры по автору, рейтингу и дате создания. поставлено ограничение по выводу текста поста. включён поиск 
по тексту. в тематиках добавлена колонка с отображением всех подписчиков. в таблице комментариев включён фильтр 
по авторам и поиск по тексту.

#### логирование
включён и настроен один журнал логирования событий. прописано несколько форматов: общий, для отладки, для 
предупреждений, для критических ошибок, для информационных сообщений, для отправки по почте. два варианта отработки: 
для включённой отладки и для выключенной. три обработчика для вывода в консоль, уровни: отладки, предупреждения, ошибки. 
три журнала в файлах: главный для всех событий, для ошибок и безопасность. один обработчик для отправки по почте. 
ведётся логирование общего уровня, запросов, сервера, шаблонов, базы данных и безопасности.

#### Локализация и интернационализация
сайт переведён на два языка. есть возможность переключать языки отображения. в моделях постов, и комментариев добавлена 
соответсвующая колонка с помощью пакета "django-modeltranslation". переведены сообщения о подписке и подтверждение 
эл-адреса, отправляются пользователю на языке соответственно настройке на сайте. дата и время на странице отображаются 
соответственно выбранному часовому поясу. от него зависит фон страницы.

#### Django REST Framework
интерфейс очень простой и без документации. всё сделано по заданию. создан сериализатор для модели постов. добавлены 
представления для новостей и статей по отдельности. включена пагинация по два поста на страницу. есть представление 
для редактирования и удаления постов. везде добавлены списки для проверки аутентификации. то есть сервер обрабатывает 
GET, HEAD и OPTIONS запросы без авторизации, а с авторизацией ещё POST, PUT и DELETE. больше тут ничего делать не надо 
было. но зато потом был целый проект REST API, который стал итоговым и на его основе проводилась итоговая 
аттестация - [он здесь](https://github.com/Archangel-Ray/SkillFacTory_Pereval).

#### и всё
на этом моменте жизнь этого проекта скоропостижно остановилась. он не доведён до состояния которое можно 
продемонстрировать. есть не стыковки, недоделки. а жаль, была проделана большая работа. 
теперь переключаемся на другой проект.

## [Доска объявлений](Publications)
**оказалось!** всё не так как казалось. оно только казалось, а вот теперь покажется иначе. 
и так, создаём новый проект (!) и вот для него "тех. задание":

>_**Здравствуйте, Олег!**_ ...(кто это такой я не знаю, но задание давалось ему)...
>
>_Нам необходимо разработать интернет-ресурс для фанатского сервера одной известной MMORPG — что-то вроде доски 
объявлений. Пользователи нашего ресурса должны иметь возможность зарегистрироваться в нём по e-mail, получив письмо с 
кодом подтверждения регистрации. После регистрации им становится доступно создание и редактирование объявлений. 
Объявления состоят из заголовка и текста, внутри которого могут быть картинки, встроенные видео и другой контент. 
Пользователи могут отправлять отклики на объявления других пользователей, состоящие из простого текста. При отправке 
отклика пользователь должен получить e-mail с оповещением о нём. Также пользователю должна быть доступна приватная 
страница с откликами на его объявления, внутри которой он может фильтровать отклики по объявлениям, удалять их и 
принимать (при принятии отклика пользователю, оставившему отклик, также должно прийти уведомление). Кроме того, 
пользователь обязательно должен определить объявление в одну из следующих категорий: Танки, Хилы, ДД, Торговцы, 
Гилдмастеры, Квестгиверы, Кузнецы, Кожевники, Зельевары, Мастера заклинаний._
>
>_Также мы бы хотели иметь возможность отправлять пользователям новостные рассылки._
>
>_Заранее спасибо!_

ну что ж. посмотрим на что я способен.

`>>> следите_за_коммитами = 'сейчас там происходит самое интересное'`

### "немного" о процессе работы над этом проектом
в этот раз, так как я не представлял конечного вида сайта делал всё по мере усложнения. 
- создал этот проект и приложение. 
- провёл миграции и добавил админа. 
- начал с модели "Категорий" зарегистрировал в админ-панели и заполнил её. 
- потом занялся визуализацией, чтоб видеть что получается. 
- сделал базовый шаблон, добавил стили и представление для его отображения. 
- сделал навигационную панель и подключил в базовом шаблоне. 
- установил allauth и подключил к проекту. 
- перенастроил аутентификацию по эл-почте. 
- подключил Яндекс провайдера для регистрации. 
- добавил кнопку "личного кабинета" в навигационной панели. 
- перенастроил шаблоны "личного кабинета" allauth и подключил их в базовом шаблоне. 
- установил пакет "ckeditor" для заполнения содержимого объявления. 
- настроил редактор "ckeditor": добавил в проект его статику, подключил загрузку файлов, подключил его к сайту. 
- создал модель "Объявления". 
- сделал форму СК-редактора для админ-панели. 
- зарегистрировал "Объявления" в админ-панели. 
- добавил настройки виджета СК-редактора и настроил их под себя. 
- добавил в СК-редактор приложение для отображения видео из Ютуба. 
но с современными ограничениями он теперь не работает. 
- сделал представление и шаблон для списка всех объявлений, перенаправил пути на новое представление. 
- подключил пути для входа в редактор для зарегистрированных пользователей. 
- сделал представление и шаблон для отображения конкретного объявления и добавил путь к нему. 
- сделал форму, представление и шаблон для редактирования объявления и добавил путь. 
- добавил пункт в навигационной панели для перехода на создание объявления. 
- переопределил валидацию формы чтоб в этом месте добавлялся пользователь-автор. 
- сделал представление для редактирования объявления с проверкой аутентификации, добавил путь. 
- в шаблоне отображения списка объявлений добавил ссылку на редактирование объявления. 
- создал модель "Комментариев", сделал для неё форму. эту форму добавил в представление и в шаблон отображения 
конкретного объявления. форма отображается только для авторизованных пользователей.
- добавил в контекст представления конкретного объявления список всех комментариев. в шаблоне сделал вывод списка. 
- в валидации формы в представлении конкретного объявления добавил отправку сообщения автору объявления о новом 
комментарии. 
- создал фильтр комментариев по объявлениям. 
- сделал представление списка комментариев и добавил ему в контекст фильтр по объявлениям. 
- подготовил шаблон для вывода списка комментариев. 
- прописал путь на вывод комментариев. 
- сделал так, чтоб фильтр получал объявления только текущего пользователя и заменил там список всех объявлений 
на список объявлений текущего пользователя. 
- добавил функцию подтверждения комментария, добавил на неё путь и добавил кнопку в шаблоне списка комментариев. 
- в этой же функции добавил отправку на почту автору комментария сообщение о подтверждении его комментария.
- в шаблоне отображения конкретного объявления сделал вывод только подтверждённых комментариев. 
- в навигационной панели сделал так чтоб пункт "личного кабинета" отображался в виде имени авторизованного пользователя. 
если никто не авторизован выводиться приглашение для входа. 
- добавил функцию удаления комментария, прописал путь на неё и добавил кнопку в шаблоне списка комментариев в личном 
кабинете. 
- установил пакет "django-admin-email-sender" для массовых рассылок. 
- на основе форм allauth создал форму для генерации и отправки "кода подтверждения" в письме для подтверждения эл-почты. 
- в настройках проекта переопределил форму подтверждения регистрации. 
- написал представление подтверждения кода регистрации, шаблон для него и шаблон неверного ввода. и прописал путь. 
- задание выполнено. 

я перечислил все мои действия. думал сделаю кратко, но получилось достаточно подробно. на все эти действия понадобилось 
семнадцать дней. ну, ещё надо учесть, что я параллельно делал основную работу. в итоге, что здесь получилось:

### модели:
- Категория
  - поля:
    - Наименование - короткое текстовое поле
  - методы:
    - Строковое представление

- Публикация
  - поля:
    - Название - короткое текстовое поле
    - Содержимое - поле СК-редактора
    - Пользователь - привязка к модели "User" один-ко-многим
    - Категория - привязка к модели "Категория" один-ко-многим
    - Дата создания - поле даты с автозаполнением
    - Дата редактирования - поле даты с автозаполнением
  - методы:
    - Строковое представление
    - Получение абсолютного пути
- Комментарий
  - поля:
    - Публикация - привязка к модели "Публикация" один-ко-многим
    - Пользователь - привязка к модели "User" один-ко-многим
    - Контент - текстовое поле
    - Дата создания - поле даты с автозаполнением
    - статус - логическое поле

все модели зарегистрированы в админ-панели.

### отображение
независимо от авторизации отображается бар-меню и открывается весь список объявлений. можно посмотреть каждое 
объявление детально. под объявлением есть список одобренных комментариев. для зарегистрированных пользователей есть 
возможность опубликовать объявление и потом редактировать его. в Объявление можно вставлять картинки и ссылки на видео. 
видео отображается как картинка предпросмотра. ещё можно оставлять комментарии под объявлениями. когда публикуется 
комментарий под Объявлением на почту отправляется извещение автору Объявления. Автор может в личном кабинете одобрить 
комментарий или удалить его. в случае одобрения, автору комментария отправляется оповещение об этом. регистрация 
возможна либо по эл-почте, либо с помощью Яндекс провайдера. для подтверждения на почту отправляется код, после ввода 
кода на сайте пользователь активируется.


## финал
я завершил этот проект, который предполагался окончательной "дипломной работой". я выполнил все задания, и они были 
оценены на сто процентов. то есть я получил максимальные баллы. ну а дальше СкиллФакТори преподносит новый сюрприз — 
["дополнительную" дипломную работу отдельно по REST API](https://github.com/Archangel-Ray/SkillFacTory_Pereval). 
я так понял, это надо было для отработки создания новых проектов.
### здесь не здесь
ну что ж. не получилось делать третью "дипломную работу" в этом репозитории, потому что в задании оценивается РидМи. 
а этот файл создаётся под репозиторием. благодаря СкиллФакТори у меня теперь есть куча репозиториев. и придётся 
создавать ещё один - [он здесь](https://github.com/Archangel-Ray/SkillFacTory_Pereval).
